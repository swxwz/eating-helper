<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¥®é£Ÿè§‰å¯ŸåŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .eating-bg {
            background: radial-gradient(circle, #fffbeb 0%, #fef3c7 100%);
        }
        .btn-bounce { transition: transform 0.1s; }
        .btn-bounce:active { transform: scale(0.95); }
    </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen font-sans">

    <div id="recordLog" class="p-4 bg-white shadow-sm max-h-32 overflow-y-auto text-sm text-gray-600">
        <div class="font-bold mb-1 text-gray-400">ç”¨é¤è§‰å¯Ÿè®°å½•ï¼š</div>
        <ul id="logList" class="space-y-1"></ul>
    </div>

    <main class="flex-grow flex flex-col items-center justify-center p-6 text-center">
        
        <div id="startScreen" class="space-y-6">
            <div class="text-6xl">ğŸ±</div>
            <button onclick="startEating()" class="btn-bounce bg-orange-500 text-white px-12 py-4 rounded-full text-xl font-bold shadow-lg">
                å¼€å§‹åƒé¥­
            </button>
        </div>

        <div id="eatingScreen" class="hidden w-full space-y-8">
            <div class="relative w-48 h-48 mx-auto bg-white rounded-full flex items-center justify-center shadow-inner eating-bg">
                <div class="text-6xl animate-bounce">ğŸ¥¢</div>
            </div>
            
            <div id="timerDisplay" class="text-gray-400 text-sm">å·²ç”¨æ—¶ï¼š00:00</div>

            <div id="questionBox" class="hidden space-y-4 animate-fade-in">
                <p class="text-lg font-medium text-gray-800">ä½ ç°åœ¨æœ‰å‡ æˆé¥±è…¹æ„Ÿï¼Ÿ</p>
                <div id="optionsContainer" class="grid grid-cols-1 gap-3">
                    </div>
            </div>

            <button onclick="stopEating()" class="mt-12 text-gray-400 underline text-sm">
                ç»“æŸåƒé¥­
            </button>
        </div>
    </main>

    <script>
        let startTime;
        let timerInterval;
        let checkInterval;
        let lastChoice = "";
        let isWaitingForChoice = false;

        const logList = document.getElementById('logList');
        const questionBox = document.getElementById('questionBox');
        const optionsContainer = document.getElementById('optionsContainer');

        // æŸ”å’Œçš„è¯­éŸ³æé†’
        function playSoftNotice() {
            const msg = new SpeechSynthesisUtterance("è¯·é—®ä½ ç°åœ¨å‡ æˆé¥±äº†ï¼Ÿ");
            msg.rate = 0.8; // è¯­é€Ÿç¨æ…¢æ›´æŸ”å’Œ
            msg.pitch = 1;
            msg.lang = 'zh-CN';
            window.speechSynthesis.speak(msg);
        }

        function startEating() {
            startTime = new Date();
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('eatingScreen').classList.remove('hidden');
            
            // å¯åŠ¨è®¡æ—¶å™¨
            timerInterval = setInterval(updateTimer, 1000);
            
            // 3åˆ†é’Ÿåç¬¬ä¸€æ¬¡æé†’ (180000ms)
            setTimeout(() => triggerCheck(), 180000);
        }

        function updateTimer() {
            const now = new Date();
            const diff = Math.floor((now - startTime) / 1000);
            const m = String(Math.floor(diff / 60)).padStart(2, '0');
            const s = String(diff % 60).padStart(2, '0');
            document.getElementById('timerDisplay').innerText = `å·²ç”¨æ—¶ï¼š${m}:${s}`;
        }

        function triggerCheck() {
            isWaitingForChoice = true;
            questionBox.classList.remove('hidden');
            generateOptions();
            
            // æŒç»­æé†’é€»è¾‘
            const reminderId = setInterval(() => {
                if (isWaitingForChoice) {
                    playSoftNotice();
                } else {
                    clearInterval(reminderId);
                }
            }, 10000); // å¦‚æœä¸é€‰ï¼Œæ¯10ç§’æŸ”å’Œæé†’ä¸€æ¬¡
            
            playSoftNotice();
        }

        function generateOptions() {
            let options = [];
            if (!lastChoice || lastChoice === "5æˆé¥±ä»¥ä¸‹") {
                options = ["5æˆé¥±ä»¥ä¸‹", "5ï¼6æˆ", "6ï¼7æˆ", "7æˆä»¥ä¸Š"];
            } else if (lastChoice === "5ï¼6æˆ") {
                options = ["5ï¼6æˆ", "6ï¼7æˆ", "7ï¼8æˆ", "8æˆä»¥ä¸Š"];
            } else if (lastChoice === "6ï¼7æˆ") {
                options = ["6ï¼7æˆ", "7ï¼8æˆ", "8ï¼9æˆ", "9æˆä»¥ä¸Š"];
            } else if (lastChoice === "7ï¼8æˆ") {
                options = ["8ï¼9æˆ", "9æˆï¼10æˆ", "10æˆè¿‡é‡", "è¶…çº§è¿‡é‡"];
            } else if (lastChoice === "8ï¼9æˆ" || lastChoice === "9æˆï¼10æˆ") {
                options = ["9æˆï¼10æˆ", "10æˆè¿‡é‡", "è¶…çº§è¿‡é‡"];
            } else if (lastChoice === "10æˆè¿‡é‡") {
                options = ["10æˆè¿‡é‡", "è¶…çº§è¿‡é‡"];
            }

            optionsContainer.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "bg-white border-2 border-orange-200 py-3 rounded-xl shadow-sm active:bg-orange-100 transition";
                btn.innerText = opt;
                btn.onclick = () => makeChoice(opt);
                optionsContainer.appendChild(btn);
            });
        }

        function makeChoice(val) {
            lastChoice = val;
            isWaitingForChoice = false;
            questionBox.classList.add('hidden');
            
            // è®°å½•æ—¶é—´æˆ³
            const now = new Date();
            const diff = Math.floor((now - startTime) / 1000);
            const timeStr = `${Math.floor(diff/60)}åˆ†${diff%60}ç§’`;
            
            const li = document.createElement('li');
            li.innerHTML = `<span class="text-orange-500 font-mono">${timeStr}</span> : ${val}`;
            logList.prepend(li);

            if (val === "è¶…çº§è¿‡é‡") {
                alert("æ£€æµ‹åˆ°å·²è¾¾åˆ°è¶…çº§è¿‡é‡ï¼Œå»ºè®®åœæ­¢è¿›é£Ÿå“¦ã€‚");
            }

            // å¼€å¯2åˆ†é’Ÿåçš„ä¸‹ä¸€æ¬¡æé†’
            setTimeout(() => triggerCheck(), 120000);
        }

        function stopEating() {
            if(confirm("ç¡®å®šç»“æŸç”¨é¤å—ï¼Ÿ")) {
                clearInterval(timerInterval);
                location.reload(); // ç®€å•é‡ç½®
            }
        }
    </script>
</body>
</html>
